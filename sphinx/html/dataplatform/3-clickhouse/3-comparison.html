
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Comparison to dbt and SQLMesh &#8212; OP Analytics  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css?v=613916f0" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'dataplatform/3-clickhouse/3-comparison';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="OP Labs Public BigQuery Data" href="../4-public-datasets/index.html" />
    <link rel="prev" title="General Purpose Data Pipelines: Transforms" href="2-transforms.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="https://github.com/ethereum-optimism/brand-kit/blob/71ea3bb1ea24e87968804b388e99bed0b52e2a4b/assets/images/optimism-wordmark-large/OPTIMISM.png?raw=true" class="logo__image only-light" alt="OP Analytics  documentation - Home"/>
    <img src="https://github.com/ethereum-optimism/brand-kit/blob/71ea3bb1ea24e87968804b388e99bed0b52e2a4b/assets/images/optimism-wordmark-large/OPTIMISM.png?raw=true" class="logo__image only-dark pst-js-only" alt="OP Analytics  documentation - Home"/>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../index.html">
    OP Labs Data Platform
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../devsetup/index.html">
    Development Guide
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../index.html">
    OP Labs Data Platform
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../devsetup/index.html">
    Development Guide
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../1-architecture.html">Architecture</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../2-blockbatch/index.html">Onchain Data Processing</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../2-blockbatch/1-design.html">Design Principles</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2-blockbatch/2-markers.html">Marker Metadata Layer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2-blockbatch/3-ingestion.html">Ingestion</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2-blockbatch/4-models.html">Blockbatch Models</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../5-datasources/index.html">Third-Party Data Ingestion</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../5-datasources/1-overview.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../5-datasources/2-dailydata-gcs.html">DailyDataset (GCS)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../5-datasources/3-clickhouse-data.html">ClickHouseDataset</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">Data Warehouse</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="1-blockbatch-loading.html">Onchain Data Pipelines: Blockbatch Load</a></li>
<li class="toctree-l2"><a class="reference internal" href="2-transforms.html">General Purpose Data Pipelines: Transforms</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Comparison to dbt and SQLMesh</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../4-public-datasets/index.html">OP Labs Public BigQuery Data</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">OP Labs Data Platform</a></li>
    
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">Data Warehouse</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Comparison to dbt and SQLMesh</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="comparison-to-dbt-and-sqlmesh">
<h1>Comparison to dbt and SQLMesh<a class="headerlink" href="#comparison-to-dbt-and-sqlmesh" title="Link to this heading">#</a></h1>
<p>In previous sections, we outlined our approach to transforming data in the warehouse.
To summarize, we have two systems:</p>
<ul class="simple">
<li><p><a class="reference internal" href="1-blockbatch-loading.html"><span class="std std-doc">blockbatch load</span></a>: optimized for onchain data ETL into the warehouse</p></li>
<li><p><a class="reference internal" href="2-transforms.html"><span class="std std-doc">transforms</span></a>: a more general-purpose transformation framework.</p></li>
</ul>
<p>These systems are conceptually similar to open-source tools like dbt and SQLMesh, which naturally
raises the question: why didn’t we just use one of those?</p>
<p>We don’t think dbt or SQLMesh are bad tools. In fact, they’re great for many teams. But for our
use case, where we value explicit control, tight database integration, and minimal abstraction, they
weren’t the right fit.</p>
<section id="what-dbt-and-sqlmesh-offer">
<h2>What dbt and SQLMesh offer<a class="headerlink" href="#what-dbt-and-sqlmesh-offer" title="Link to this heading">#</a></h2>
<p>Both dbt and SQLMesh are mature, well-documented frameworks designed to make data transformation
easier and more maintainable. Their main selling points include:</p>
<ul class="simple">
<li><p>Data lineage and dependency graphs.</p></li>
<li><p>Testability and automated data quality checks.</p></li>
<li><p>Orchestration support (via CLI or integrations).</p></li>
<li><p>Abstractions over database DDL and model lifecycle.</p></li>
</ul>
<p>These tools are widely adopted because they abstract many of the complexities of managing data
pipelines. But abstraction comes at a cost.</p>
</section>
<section id="why-we-didn-t-chose-dbt-or-sqlmesh">
<h2>Why we didn’t chose dbt or SQLMesh<a class="headerlink" href="#why-we-didn-t-chose-dbt-or-sqlmesh" title="Link to this heading">#</a></h2>
<section id="lineage">
<h3>Lineage<a class="headerlink" href="#lineage" title="Link to this heading">#</a></h3>
<p>Lineage is arguably the most visible advantage. dbt users love seeing their data graph grow ever
more complex, and tracking how upstream data flows into downstream models. It feels powerful.</p>
<p>But in our experience, aside from the visual appeal, it does not offer practical benefits
for operating or maintaining the pipeline. When upstream data changes, tools like dbt or SQLMesh
can automatically recompute all downstream tables. But do you want to do that? What about compute
costs? Do you want to overwrite existing downstream tables or maybe create new versions so you
can compare changes?</p>
<p>As a pipeline operator one has to make decisions when backfilling and it’s rare when the answer
is free of subtleties. Nuanced understanding of the data and business logic is needed to make the
right choice. For that reason we prefer to make decisions explicitly instead of relying on
framework capabilities that can be powerful but are a black box.</p>
</section>
<section id="testability">
<h3>Testability<a class="headerlink" href="#testability" title="Link to this heading">#</a></h3>
<p>Testability and lineage are closely related. If I change something in an upstream model, which
downstream models am I going to break? To answer this question you need lineage and you need
a fast way to evaluate models to ensure everything will be OK.</p>
<p>Our philosophy on this is that structural problems will manifest while you prototype or shortly
after you deploy (if you deploy a change without prototyping).  Semantic issues around the data
are not as easily preventable so you still have to watch out for them.</p>
<p>When codebases get bigger and there is not a single team but many teams collaborating with each
other then testability starts becoming non-negotiable. But at the scale of our team it is
something that we can live without.</p>
</section>
<section id="sql-first-no-indirection">
<h3>SQL First (no indirection)<a class="headerlink" href="#sql-first-no-indirection" title="Link to this heading">#</a></h3>
<p>The CLI surface for dbt and SQLMesh is powerful, but that power can be a double-edged sword.
Invoking the right command requires deep knowledge of how your project is configured and how
scheduling is set up. It’s easy to end up spending time just figuring out how to run the “correct”
command or how to configure the project so that execution of a command results in the desired
action in the database.</p>
<p>Tools like dbt/SQLMesh reserve the right to talk to the database. This at first sounds good. But
when you are outside the happy path, and need to understand or debug exactly what’s happening,
that extra layer stands in the way.</p>
<p>To support multiple engines, tools like dbt and SQLMesh are designed to work with a lowest common
denominator of database features. That works well for portability, but less so if you want to use
the more powerful features of a specific database engine to your advantage.</p>
<p>The above is specially true for a data warehouse like ClickHouse, where a lot of the data management
facilities are provided to you by the specific table engine that you pick when using a table.
When creating a table you may also want to have indexes or use special data types and codecs to
optimize compression. Or you may want to control how partitions or individual columns in a table
are expired.  You want to do this speaking directly to the database and not through a YAML
or JSON config.</p>
<p>Our approach centers around writing the exact CREATE TABLE statement that will be executed. There’s
no schema inference, no translation layer, and no assumption about what you want. If you want a
specific engine, codec, or index—just write it. This makes the system transparent, predictable,
and lets you use all of the database’s strengths.</p>
</section>
</section>
<section id="when-dbt-and-sqlmesh-might-be-a-better-fit">
<h2>When dbt and SQLMesh might be a better fit<a class="headerlink" href="#when-dbt-and-sqlmesh-might-be-a-better-fit" title="Link to this heading">#</a></h2>
<p>At large enough organizations you start having two different personas in your data platform.
Platform users, who understand the data and business logic and build the data pipelines, and
platform maintainers, who operate the shared frameworks, are in charge of orchestration, and have
a global view of the data platform.</p>
<p>When a team is small the two responsibilities blur and so you are better off minimizing the friction
and process involved. As team grows larger, platform maintainers need to worry about global resource
utilization and being able to have a common model for monitoring and executing jobs.</p>
<p>This is when large-scale frameworks like dbt and SQLMesh can be most helpful. They get in the
way of advanced platform users, but help beginner platform users avoid foot-guns and ensure a level
of uniformity across pipelines that is needed to keep global objectives and cost in check.</p>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="2-transforms.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">General Purpose Data Pipelines: Transforms</p>
      </div>
    </a>
    <a class="right-next"
       href="../4-public-datasets/index.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">OP Labs Public BigQuery Data</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-dbt-and-sqlmesh-offer">What dbt and SQLMesh offer</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#why-we-didn-t-chose-dbt-or-sqlmesh">Why we didn’t chose dbt or SQLMesh</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lineage">Lineage</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#testability">Testability</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sql-first-no-indirection">SQL First (no indirection)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#when-dbt-and-sqlmesh-might-be-a-better-fit">When dbt and SQLMesh might be a better fit</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/dataplatform/3-clickhouse/3-comparison.md.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2024, OP Labs.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.2.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>